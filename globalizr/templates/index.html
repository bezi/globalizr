{% extends "base.html" %}
{% load staticfiles %}
{% block head %}
{% endblock %}

{% block content %}
<div class="container">
    <div class="globe-screen">
        <a href="/"><h1>globalizr</h1></a>
        <form id="globe-form" autocomplete="off">
            <input type="search" id="globe-search" placeholder="globalize it." onfocus="this.placeholder = ''"/>
        </form>
    </div>
    <div id="input-wrapper">
        <h1 id="landing-header">globalizr</h1>
        <div class="row">
            <div class="col-md-10 col-md-offset-1">
                <form id="landing-form" autocomplete="off">
                    <input type="search" id="landing-search" placeholder="globalize it." onfocus="this.placeholder = ''"/>
                </form>
            </div>
        </div>
        <div class="row">
            <ul class="about-list">
                <li><button id="what-btn" class="btn what-btn">What</button></li>
                <li><button id="how-btn" class="btn how-btn">How</button></li>
                <li><button id="about-btn" class="btn about-btn">About</button></li>
            </ul>
        </div>
    </div>
</div><!-- /.container -->
<div id="what-info" class="info-div">
    <div class="row">
        <div class="col-md-10 col-md-offset-1">
            <h1>What is globalizr?</h1>
            <p class="lead"><span class="branding">globalizr</span> is a next generation data visualization tool and API. Centered around the idea that information should be both useful and beautiful, both easy-to-use and powerful, <span class="branding">globalizr</span> takes database queries and plots them on a global scale. First, we take geographic demographic data from many different data stores and accumulate it. Then, once the user (you!) makes a query, it retrieves the needed data and renders a three-dimensional, interactive globe depicting the query. Give it a shot! Head over to the &ldquo;About&rdquo; page to check out some sample queries!</p>
            <p class="lead">All of this is fully pluggable as well. We offer an API so that any user can retrieve our aggregated geographic data over HTTP. The data is transmitted in JSON format, consisting of mainly longitude-latitude pairs and their corresponding magnitudes, along with some descriptive metadata. If you use this data, <a href="mailto:admin@organizr.org">let us know</a>! We love hearing all the cool things that people are doing.</p>
        </div>
    </div>
    <div class="row">
        <ul class="about-list">
            <li><button id="what-btn-back" class="btn">Back</button></li>
            <li><button class="btn how-btn">How</button></li>
            <li><button class="btn about-btn">About</button></li>
        </ul>
    </div>
</div>
<div id="how-info" class="info-div">
    <div class="row">
        <div class="col-md-10 col-md-offset-1">
            <h1>How do I use globalizr?</h1>
            <p class="lead">To use <span class="branding">globalizr</span>, you have to construct a <em>query</em> in the format <em>&lt;interface&gt;&lt;metric&gt;</em>. What this means is that you specify what type of data to retrieve and what metric to display about that data. Check out some of the awesome starter queries we have below!</p>
            <ul class="no-bullet">
                <li class="lead"><a href="#" id="how1">weather high</a></li>
                <li class="lead"><a href="#" id="how2">weather pressure</a></li>
                <li class="lead"><a href="#" id="how3">flickr october2013</a></li>
                <li class="lead"><a href="#" id="how4">university</a></li>
            </ul>
            <p class="lead">To use the raw data that's at the heart of the above queries, check us out on <a href="https://github.com/obezi/HackPrinceton">GitHub</a> to find documentation for how to structure your API data requests over HTTP.</p>
        </div>
    </div>
    <div class="row">
        <ul class="about-list">
            <li><button class="btn what-btn">What</button></li>
            <li><button id="how-btn-back" class="btn">Back</button></li>
            <li><button class="btn about-btn">About</button></li>
        </ul>
    </div>
</div>
<div id="about-info" class="info-div">
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <h1>About globalizr</h1>
            <h2>Developers</h2>
            <div id="devs-row" class="row">
                <img class="col-md-3 img-circle" src="{% static 'imgs/devs/oscar-bw.jpg' %}" />
                <img class="col-md-3 img-circle" src="{% static 'imgs/devs/sinan-bw.jpg' %}" />
                <img class="col-md-3 img-circle" src="{% static 'imgs/devs/andre-bw.jpg' %}" />
                <img class="col-md-3 img-circle" src="{% static 'imgs/devs/jacob-bw.jpg' %}" />
            </div>
            <div class="row text-center">
                <h4 class="col-md-3">Oscar</h4>
                <h4 class="col-md-3">Sinan</h4>
                <h4 class="col-md-3">Andre</h4>
                <h4 class="col-md-3">Jake</h4>
            </div>
            <br />
            <p class="lead"><span class="branding">globalizr</span> was created at <a href="http://www.hackprinceton.com/">Hack.Princeton</a> by <a href="http://www.oscarbezi.com/">Oscar Bezi</a>, <a href="mailto:cepel.sinan@gmail.com">Sinan Cepel</a>, <a href="mailto:ajia@gmail.com">Andre Jia</a>, and <a href="http://www.jacobzimmerman.me">Jacob Zimmerman</a>, CS freshmen at <a href="http://www.cmu.edu/">Carnegie Mellon University</a>.</p>
            <h2>Technologies</h2>
            <p class="lead">Due to data aggregation nature of <span class="branding">globalizr</span>, a multitude of APIs and backend technologies are working together behind the scenes. Check out the list below to learn more.</p>
            <div class="row">
                <div class="text-center col-md-4">
                    <h3>Infrastructure</h3>
                    <p>The deployment environment consists of a custom <a href="http://www.getbootstrap.com">Bootstrap</a> build for the frontend and a <a href="http://www.heroku.com">Heroku</a> instance running <a href="http://www.djangoproject.com">Django</a> on the backend.</p>
                </div>
                <div class="text-center col-md-4">
                    <h3>Data</h3>
                    <p>We designed this system to be able to interface with any system where we can get JSON data that has GPS data paired with values. For this reason, we were able to draw upon a multitude of data retrieval APIs, including the following:</p>
                    <p><a href="http://http://developer.yahoo.com/yql/">Yahoo Query Language</a></p>
                    <p><a href="http://www.flickr.com/services/api/">flickr</a></p>
                    <p><a href="https://developers.google.com/maps/">Google Maps</a></p>
                    <p><a href="http://www.timeshighereducation.co.uk/">Times Higher Education</a></p>
                </div>
                <div class="text-center col-md-4">
                    <h3>Globe</h3>
                    <p>To render the actual data, we use the Google Chrome Experiment <a href="http://www.chromeexperiments.com/globe">The WebGL Globe</a>, which is an open platform for data visualization.</p>
                </div>
            </div>
        </div>
    </div> 
    <div class="row">
        <ul class="about-list">
            <li><button class="btn what-btn">What</button></li>
            <li><button class="btn how-btn">How</button></li>
            <li><button id="about-btn-back"class="btn">Back</button></li>
        </ul>
    </div>
</div>
<div id="container"></div>
<script type="text/javascript" src="{% static 'js/Detector.js' %}"></script>
<script type="text/javascript" src="{% static 'js/three.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/Tween.js' %}"></script>
<script type="text/javascript" src="{% static 'js/globe.js' %}"></script>
<script type="text/javascript">
    function submitQuery(query) {
        if(!Detector.webgl){
            Detector.addGetWebGLMessage();
        } else {
            var addr = "/api/interface/";

            vals = query.split(" ");
            if (vals.length > 0) {
                interf = vals[0].toLowerCase();
                addr = addr + interf + "/"
            } else {
                return false;
            }
    
            if (vals.length > 1) {
                disc = vals[1].toLowerCase();
                add = addr + disc + "/"
            } else {
                disc = null;
            }

            var xhr;
            xhr = new XMLHttpRequest();
            xhr.open('GET', addr, true);
            xhr.onreadystatechange = function(e) {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        if (response.status == 0) { // no errors
                            var container = document.getElementById('container');
                            var globe = new DAT.Globe(container);

                            var i, tweens = [];
                          
                            TWEEN.start();
                            if (disc == null) {
                                disc = response.keys[0];
                            }
                            globe.addData(response.data[disc], {format: 'magnitude', name: response.metadata[disc], animated: true});
                            globe.createPoints();
                            globe.animate();
                            $("#toolbar-interface").text(interf[0].toUpperCase() + interf.slice(1));
                            $("li").remove(".added");
                            for ( var x = 0; x < response.keys.length; x++) {
                                if (response.keys[x] == disc) {
                                    $("#toolbar-list").append('<li class="active added"><a href="#">' + response.keys[x] + '</a></li>');
                                } else {
                                    strings = interf + ' ' + response.keys[x];
                                    $("#toolbar-list").append('<li id="' + strings + '" class="added"><a href="#" >' + response.keys[x] + '</a></li>');
                                    $("#" + strings).on("click", function() { submitQuery(strings);});
                                }
                            }
                            setTimeout(toolbarExpand, 500);
                        }
                    } 
                }
            };
            xhr.send(null)
            return true;
        }
        return false;   
    }
</script>
<div id="toolbar">
    <div id="toolbar-collapse-btn">
        <span class="glyphicon glyphicon-chevron-left"></span>
    </div>
    <h1 id="toolbar-interface">Weather</h1>
    <div class="sidebar-nav">
        <ul id="toolbar-list" class="nav nav-list">
            <li class="nav-header"><h2>Try adding. . .</h2></li>
        </ul>
    </div>
    <br />
    <!-- AddToAny BEGIN -->
    <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
        <a class="a2a_dd" href="http://www.addtoany.com/share_save"></a>
        <a class="a2a_button_facebook"></a>
        <a class="a2a_button_twitter"></a>
        <a class="a2a_button_google_plus"></a>
    </div>
    <script type="text/javascript" src="//static.addtoany.com/menu/page.js"></script>
    <!-- AddToAny END -->
</div>
{% endblock %}
{% block scripts %}
<script>
    function hideGUI() {
        $("#input-wrapper").css('display', 'none');
    }
    $("#toolbar-collapse-btn").on("click", toolbarCollapse);

    function toolbarExpand() {
        $("#toolbar-collapse-btn").on("click", toolbarCollapse);
        $("#toolbar").css('left', "0px");
        $("#toolbar-collapse-btn").children().addClass("glyphicon-chevron-left");
        $("#toolbar-collapse-btn").children().removeClass("glyphicon-chevron-right");
    }

    function toolbarCollapse() {
        $("#toolbar-collapse-btn").on("click", toolbarExpand);
        $("#toolbar").css('left', "-20%");
        $("#toolbar-collapse-btn").children().removeClass("glyphicon-chevron-left");
        $("#toolbar-collapse-btn").children().addClass("glyphicon-chevron-right");
    }

    $(document).ready(function() {
        $("#input-wrapper").css("opacity", 1);
        $("#landing-form").on("submit", function (e) {
            e.preventDefault();
            if (submitQuery($("#landing-search").val())) {
                hideGUI();
                $(".globe-screen").css("display", "block");
            } else {
                $("#landing-search").innerHTML = '';
            }
        });
        setTimeout(function() {$("#input-wrapper").css("-webkit-transition", "display 1s")}, 2000);
        setTimeout(function() {$("#input-wrapper").css("transition", "display 1s")}, 2000);
    });
    $("#globe-form").on("submit", function(e) {
        e.preventDefault();
        submitQuery($("#globe-search").val());
    });

    // Hard coded hack
    $("#how1").on("click", function(e) {
        e.preventDefault();
        $("#how-info").css("z-index", -1).css("opacity", 0);
        hideGUI();
        if (submitQuery("weather high")){
            hideGUI();
            $(".globe-screen").css("display", "block");
        } else {
            $("#landing-search").innerHTML = '';
        }
    });
    $("#how2").on("click", function(e) {
        e.preventDefault();
        $("#how-info").css("z-index", -1).css("opacity", 0);
        hideGUI();
        if (submitQuery("weather pressure")){
            hideGUI();
            $(".globe-screen").css("display", "block");
        } else {
            $("#landing-search").innerHTML = '';
        }
    });
    $("#how3").on("click", function(e) {
        e.preventDefault();
        $("#how-info").css("z-index", -1).css("opacity", 0);
        hideGUI();
        if (submitQuery("flickr")){
            hideGUI();
            $(".globe-screen").css("display", "block");
        } else {
            $("#landing-search").innerHTML = '';
        }
    });
    $("#how4").on("click", function(e) {
        e.preventDefault();
        $("#how-info").css("z-index", -1).css("opacity", 0);
        hideGUI();
        if (submitQuery("university")){
            hideGUI();
            $(".globe-screen").css("display", "block");
        } else {
            $("#landing-search").innerHTML = '';
        }
    });

    $(".what-btn").on("click", function() {
        $("#input-wrapper").css("opacity", 0);
        $("#how-info").css("z-index", -1).css("opacity", 0);
        $("#about-info").css("z-index", -1).css("opacity", 0);
        $("#what-info").css("z-index", 1).css("opacity", 1);
    });
    $(".how-btn").on("click", function() {
        $("#input-wrapper").css("opacity", 0);
        $("#what-info").css("z-index", -1).css("opacity", 0);
        $("#about-info").css("z-index", -1).css("opacity", 0);
        $("#how-info").css("z-index", 1).css("opacity", 1);
    });
    $(".about-btn").on("click", function() {
        $("#input-wrapper").css("opacity", 0);
        $("#how-info").css("z-index", -1).css("opacity", 0);
        $("#what-info").css("z-index", -1).css("opacity", 0);
        $("#about-info").css("z-index", 1).css("opacity", 1);
    });
    $("#what-btn-back").on("click", function() {
        $("#what-info").css("z-index", -1).css("opacity", 0);
        $("#input-wrapper").css("opacity", 1);
    });
    $("#how-btn-back").on("click", function() {
        $("#how-info").css("z-index", -1).css("opacity", 0);
        $("#input-wrapper").css("opacity", 1);
    });
    $("#about-btn-back").on("click", function() {
        $("#about-info").css("z-index", -1).css("opacity", 0);
        $("#input-wrapper").css("opacity", 1);
    });
</script>
{% endblock %}
